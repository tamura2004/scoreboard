(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{48:(e,r,t)=>{Promise.resolve().then(t.bind(t,7199))},1193:(e,r,t)=>{"use strict";t.d(r,{Q:()=>c,S:()=>d});var i=t(5155),n=t(2115),l=t(9580);let s=(0,n.createContext)(void 0),o={PLAYERS:"scoreboard_players",HISTORY:"scoreboard_history"},a=[{id:"1",name:"プレイヤー1",score:0},{id:"2",name:"プレイヤー2",score:0},{id:"3",name:"プレイヤー3",score:0},{id:"4",name:"プレイヤー4",score:0}],c=()=>{let e=(0,n.useContext)(s);if(!e)throw Error("useScore must be used within ScoreProvider");return e},d=e=>{let{children:r}=e,[t,c]=(0,n.useState)(a),[d,h]=(0,n.useState)([]),[x,p]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{(()=>{try{let e=localStorage.getItem(o.PLAYERS),r=localStorage.getItem(o.HISTORY);e&&c(JSON.parse(e)),r&&h(JSON.parse(r))}catch(e){console.error("Failed to load from localStorage:",e)}finally{p(!0)}})()},[]),(0,n.useEffect)(()=>{if(x)try{localStorage.setItem(o.PLAYERS,JSON.stringify(t))}catch(e){console.error("Failed to save players to localStorage:",e)}},[t,x]),(0,n.useEffect)(()=>{if(x)try{localStorage.setItem(o.HISTORY,JSON.stringify(d))}catch(e){console.error("Failed to save history to localStorage:",e)}},[d,x]),(0,i.jsx)(s.Provider,{value:{players:t,history:d,addPlayer:()=>{if(t.length>=l.iq)return void alert("プレイヤーは最大".concat(l.iq,"人までです"));let e={id:Date.now().toString(),name:"プレイヤー".concat(t.length+1),score:0};c([...t,e])},removeLastPlayer:()=>{if(t.length<=l.wC)return void alert("プレイヤーは最低".concat(l.wC,"人必要です"));let e=t[t.length-1];c(t.slice(0,-1)),h(d.filter(r=>r.playerId!==e.id))},updatePlayerName:(e,r)=>{c(t.map(t=>t.id===e?{...t,name:r}:t)),h(d.map(t=>t.playerId===e?{...t,playerName:r}:t))},addScore:(e,r)=>{let i=t.find(r=>r.id===e);if(!i)return;let n=i.score+r;if(n<l.o||n>l.sz)return void alert("スコアは".concat(l.o,"-").concat(l.sz,"の範囲で入力してください"));let s=d.filter(r=>r.playerId===e).length,o={id:Date.now().toString(),playerId:e,playerName:i.name,score:r,totalScore:n,timestamp:Date.now(),sequenceNumber:s+1};c(t.map(r=>r.id===e?{...r,score:n}:r)),h([o,...d])},undoHistory:e=>{let r=d.find(r=>r.id===e);if(!r||!t.find(e=>e.id===r.playerId))return;let i=r.totalScore-r.score;c(t.map(e=>e.id===r.playerId?{...e,score:i}:e)),h(d.filter(r=>r.id!==e))},resetAll:()=>{c(a),h([])}},children:r})}},7199:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>z});var i=t(5155),n=t(8492),l=t(2531),s=t(9488),o=t(2428),a=t(4288),c=t(6245),d=t(9560),h=t(3051),x=t(8520),p=t(6999),m=t(5427),j=t(2619),f=t.n(j),u=t(2115),A=t(539),g=t(4627),y=t(6869),S=t(357),v=t(5265),C=t(2021),w=t(9496),b=t(8588),k=t(6370),I=t(7855),E=t(6596),N=t(1665),P=t(1193),O=t(982);let R=e=>{let{value:r,onChange:t}=e,n=e=>{let i=r+e;i>=0&&t(i)},l={width:"50%",height:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s","&:hover":{bgcolor:"action.hover"},"&:active":{bgcolor:"action.selected"}};return(0,i.jsxs)(S.A,{sx:{position:"relative",width:"120px",height:"80px",display:"flex",flexWrap:"wrap"},children:[(0,i.jsx)(O.A,{sx:l,onClick:()=>n(10)}),(0,i.jsx)(O.A,{sx:l,onClick:()=>n(1)}),(0,i.jsx)(O.A,{sx:l,onClick:()=>n(-10)}),(0,i.jsx)(O.A,{sx:l,onClick:()=>n(-1)}),(0,i.jsx)(S.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",pointerEvents:"none"},children:(0,i.jsx)(s.A,{variant:"h2",fontWeight:"bold",color:"primary",children:r})})]})},W=e=>{let{player:r}=e,{updatePlayerName:t,addScore:n,history:l}=(0,P.Q)(),[o,c]=(0,u.useState)(0),[d,h]=(0,u.useState)(!1),[x,p]=(0,u.useState)(r.name),m=(0,u.useRef)(null),j=l.filter(e=>e.playerId===r.id).length,f=()=>{h(!1),p(r.name)},O=()=>{x.trim()?(t(r.id,x),h(!1)):p(r.name)};return(0,i.jsxs)(A.A,{sx:{height:"100%"},children:[(0,i.jsx)(g.A,{sx:{py:2,"&:last-child":{pb:2}},children:(0,i.jsxs)(y.A,{spacing:1,children:[(0,i.jsxs)(S.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,i.jsx)(a.A,{size:"small",onClick:()=>{/^プレイヤー\d+$/.test(r.name)?p(""):p(r.name),h(!0)},sx:{p:.5},children:(0,i.jsx)(N.A,{fontSize:"small"})}),(0,i.jsxs)(s.A,{variant:"h6",noWrap:!0,sx:{flexGrow:1},children:[r.name,(0,i.jsxs)(s.A,{component:"span",variant:"body2",color:"text.secondary",sx:{ml:1},children:["(",j,"ターン)"]})]})]}),(0,i.jsxs)(y.A,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{width:"100%"},children:[(0,i.jsx)(S.A,{sx:{display:"flex",justifyContent:"center",width:"120px"},children:(0,i.jsx)(s.A,{variant:"h2",sx:{fontWeight:"bold",color:"primary.main"},children:r.score})}),(0,i.jsx)(a.A,{color:"primary",onClick:()=>{0!==o&&(n(r.id,o),c(0))},disabled:0===o,sx:{bgcolor:"primary.main",color:"white",width:48,height:48,"&:hover":{bgcolor:"primary.dark"},"&:disabled":{bgcolor:"action.disabledBackground"}},children:(0,i.jsx)(E.A,{fontSize:"large"})}),(0,i.jsx)(S.A,{sx:{display:"flex",justifyContent:"center"},children:(0,i.jsx)(R,{value:o,onChange:c})})]})]})}),(0,i.jsxs)(v.A,{open:d,onClose:f,maxWidth:"xs",fullWidth:!0,TransitionProps:{onEntered:()=>{var e;null==(e=m.current)||e.focus()}},children:[(0,i.jsx)(C.A,{children:"プレイヤー名の編集"}),(0,i.jsx)(w.A,{children:(0,i.jsx)(b.A,{value:x,onChange:e=>p(e.target.value),inputRef:m,fullWidth:!0,margin:"dense",label:"プレイヤー名",onKeyDown:e=>{"Enter"===e.key&&O()}})}),(0,i.jsxs)(k.A,{children:[(0,i.jsx)(I.A,{onClick:f,children:"キャンセル"}),(0,i.jsx)(I.A,{onClick:O,variant:"contained",children:"保存"})]})]})]})};var _=t(9580);function z(){let{players:e,addPlayer:r,removeLastPlayer:t,resetAll:j}=(0,P.Q)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.A,{position:"static",children:(0,i.jsxs)(l.A,{children:[(0,i.jsx)(s.A,{variant:"h6",component:"div",sx:{flexGrow:1},children:"スコアボード"}),(0,i.jsx)(o.A,{title:"プレイヤーを追加 (".concat(e.length,"/").concat(_.iq,")"),children:(0,i.jsx)("span",{children:(0,i.jsx)(a.A,{color:"inherit",onClick:r,disabled:e.length>=_.iq,sx:{mr:2},children:(0,i.jsx)(h.A,{})})})}),(0,i.jsx)(o.A,{title:"プレイヤーを削除",children:(0,i.jsx)("span",{children:(0,i.jsx)(a.A,{color:"inherit",onClick:t,disabled:e.length<=_.wC,sx:{mr:2},children:(0,i.jsx)(x.A,{})})})}),(0,i.jsx)(o.A,{title:"初期化",children:(0,i.jsx)(a.A,{color:"inherit",onClick:()=>{window.confirm("すべてのプレイヤーとスコア履歴を初期化しますか？")&&j()},sx:{mr:2},children:(0,i.jsx)(p.A,{})})}),(0,i.jsx)(o.A,{title:"履歴",children:(0,i.jsx)(a.A,{color:"inherit",component:f(),href:"/history",children:(0,i.jsx)(m.A,{})})})]})}),(0,i.jsx)(c.A,{maxWidth:"lg",sx:{py:3},children:(0,i.jsx)(d.A,{container:!0,spacing:2,children:e.map(e=>(0,i.jsx)(d.A,{size:6,children:(0,i.jsx)(W,{player:e})},e.id))})})]})}},9580:(e,r,t)=>{"use strict";t.d(r,{iq:()=>i,o:()=>l,sz:()=>s,wC:()=>n});let i=10,n=1,l=0,s=999}},e=>{e.O(0,[422,809,323,199,441,255,358],()=>e(e.s=48)),_N_E=e.O()}]);