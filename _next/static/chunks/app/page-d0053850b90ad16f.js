(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{48:(e,r,t)=>{Promise.resolve().then(t.bind(t,9580))},1193:(e,r,t)=>{"use strict";t.d(r,{Q:()=>c,S:()=>d});var i=t(5155),l=t(2115),n=t(7199);let s=(0,l.createContext)(void 0),a={PLAYERS:"scoreboard_players",HISTORY:"scoreboard_history",REGISTERED_PLAYERS:"scoreboard_registered_players"},o=[{id:"1",name:"プレイヤー1",score:0},{id:"2",name:"プレイヤー2",score:0},{id:"3",name:"プレイヤー3",score:0},{id:"4",name:"プレイヤー4",score:0}],c=()=>{let e=(0,l.useContext)(s);if(!e)throw Error("useScore must be used within ScoreProvider");return e},d=e=>{let{children:r}=e,[t,c]=(0,l.useState)(o),[d,h]=(0,l.useState)([]),[x,m]=(0,l.useState)([]),[p,f]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{(()=>{try{let e=localStorage.getItem(a.PLAYERS),r=localStorage.getItem(a.HISTORY),t=localStorage.getItem(a.REGISTERED_PLAYERS);e&&c(JSON.parse(e)),r&&h(JSON.parse(r)),t&&m(JSON.parse(t))}catch(e){console.error("Failed to load from localStorage:",e)}finally{f(!0)}})()},[]),(0,l.useEffect)(()=>{if(p)try{localStorage.setItem(a.PLAYERS,JSON.stringify(t))}catch(e){console.error("Failed to save players to localStorage:",e)}},[t,p]),(0,l.useEffect)(()=>{if(p)try{localStorage.setItem(a.HISTORY,JSON.stringify(d))}catch(e){console.error("Failed to save history to localStorage:",e)}},[d,p]),(0,l.useEffect)(()=>{if(p)try{localStorage.setItem(a.REGISTERED_PLAYERS,JSON.stringify(x))}catch(e){console.error("Failed to save registered players to localStorage:",e)}},[x,p]),(0,i.jsx)(s.Provider,{value:{players:t,history:d,registeredPlayers:x,addPlayer:()=>{if(t.length>=n.iq)return void alert("プレイヤーは最大".concat(n.iq,"人までです"));let e={id:Date.now().toString(),name:"プレイヤー".concat(t.length+1),score:0};c([...t,e])},removeLastPlayer:()=>{if(t.length<=n.wC)return void alert("プレイヤーは最低".concat(n.wC,"人必要です"));let e=t[t.length-1];c(t.slice(0,-1)),h(d.filter(r=>r.playerId!==e.id))},updatePlayerName:(e,r)=>{c(t.map(t=>t.id===e?{...t,name:r}:t)),h(d.map(t=>t.playerId===e?{...t,playerName:r}:t))},addScore:(e,r)=>{let i=t.find(r=>r.id===e);if(!i)return;let l=i.score+r;if(l<n.o||l>n.sz)return void alert("スコアは".concat(n.o,"-").concat(n.sz,"の範囲で入力してください"));let s=d.filter(r=>r.playerId===e).length,a={id:Date.now().toString(),playerId:e,playerName:i.name,score:r,totalScore:l,timestamp:Date.now(),sequenceNumber:s+1};c(t.map(r=>r.id===e?{...r,score:l}:r)),h([a,...d])},undoHistory:e=>{let r=d.find(r=>r.id===e);if(!r||!t.find(e=>e.id===r.playerId))return;let i=r.totalScore-r.score;c(t.map(e=>e.id===r.playerId?{...e,score:i}:e)),h(d.filter(r=>r.id!==e))},resetAll:()=>{c(o),h([])},addRegisteredPlayer:e=>{m([...x,{id:Date.now().toString(),name:e.trim()}])},updateRegisteredPlayer:(e,r)=>{m(x.map(t=>t.id===e?{...t,name:r.trim()}:t))},deleteRegisteredPlayer:e=>{m(x.filter(r=>r.id!==e))}},children:r})}},7199:(e,r,t)=>{"use strict";t.d(r,{iq:()=>i,o:()=>n,sz:()=>s,wC:()=>l});let i=10,l=1,n=0,s=999},9580:(e,r,t)=>{"use strict";t.r(r),t.d(r,{default:()=>q});var i=t(5155),l=t(8492),n=t(2531),s=t(9488),a=t(2428),o=t(4288),c=t(6245),d=t(9560),h=t(3051),x=t(8520),m=t(6999),p=t(5427),f=t(6946),j=t(2619),g=t.n(j),u=t(2115),A=t(539),y=t(4627),S=t(6869),v=t(357),C=t(5265),b=t(2021),w=t(9496),E=t(2995),I=t(8060),R=t(4012),k=t(3033),P=t(670),N=t(6370),_=t(7855),O=t(6596),W=t(1665),Y=t(1193),D=t(982);let z=e=>{let{value:r,onChange:t}=e,l=e=>{let i=r+e;i>=0&&t(i)},n={width:"50%",height:"50%",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s","&:hover":{bgcolor:"action.hover"},"&:active":{bgcolor:"action.selected"}};return(0,i.jsxs)(v.A,{sx:{position:"relative",width:"120px",height:"80px",display:"flex",flexWrap:"wrap"},children:[(0,i.jsx)(D.A,{sx:n,onClick:()=>l(10)}),(0,i.jsx)(D.A,{sx:n,onClick:()=>l(1)}),(0,i.jsx)(D.A,{sx:n,onClick:()=>l(-10)}),(0,i.jsx)(D.A,{sx:n,onClick:()=>l(-1)}),(0,i.jsx)(v.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",pointerEvents:"none"},children:(0,i.jsx)(s.A,{variant:"h2",fontWeight:"bold",color:"primary",children:r})})]})},L=e=>{let{player:r}=e,{players:t,updatePlayerName:l,addScore:n,history:a,registeredPlayers:c,addRegisteredPlayer:d}=(0,Y.Q)(),[h,x]=(0,u.useState)(0),[m,p]=(0,u.useState)(!1),[f,j]=(0,u.useState)(r.name),g=(0,u.useRef)(null),D=a.filter(e=>e.playerId===r.id).length,L=()=>{p(!1),j(r.name)},T=()=>{let e=f.trim();if(e){if(t.some(t=>t.id!==r.id&&t.name===e))return void alert("同じ名前のプレイヤーがすでに存在します");let i=/^プレイヤー\d+$/.test(e),n=c.some(r=>r.name===e);i||n||d(e),l(r.id,e),p(!1)}else j(r.name)};return(0,i.jsxs)(A.A,{sx:{height:"100%"},children:[(0,i.jsx)(y.A,{sx:{py:2,"&:last-child":{pb:2}},children:(0,i.jsxs)(S.A,{spacing:1,children:[(0,i.jsxs)(v.A,{sx:{display:"flex",alignItems:"center",gap:.5},children:[(0,i.jsx)(o.A,{size:"small",onClick:()=>{/^プレイヤー\d+$/.test(r.name)?j(""):j(r.name),p(!0)},sx:{p:.5},children:(0,i.jsx)(W.A,{fontSize:"small"})}),(0,i.jsxs)(s.A,{variant:"h6",noWrap:!0,sx:{flexGrow:1},children:[r.name,(0,i.jsxs)(s.A,{component:"span",variant:"body2",color:"text.secondary",sx:{ml:1},children:["(",D,"ターン)"]})]})]}),(0,i.jsxs)(S.A,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{width:"100%"},children:[(0,i.jsx)(v.A,{sx:{display:"flex",justifyContent:"center",width:"120px"},children:(0,i.jsx)(s.A,{variant:"h2",sx:{fontWeight:"bold",color:"primary.main"},children:r.score})}),(0,i.jsx)(o.A,{color:"primary",onClick:()=>{0!==h&&(n(r.id,h),x(0))},disabled:0===h,sx:{bgcolor:"primary.main",color:"white",width:48,height:48,"&:hover":{bgcolor:"primary.dark"},"&:disabled":{bgcolor:"action.disabledBackground"}},children:(0,i.jsx)(O.A,{fontSize:"large"})}),(0,i.jsx)(v.A,{sx:{display:"flex",justifyContent:"center"},children:(0,i.jsx)(z,{value:h,onChange:x})})]})]})}),(0,i.jsxs)(C.A,{open:m,onClose:L,maxWidth:"xs",fullWidth:!0,TransitionProps:{onEntered:()=>{var e;null==(e=g.current)||e.focus()}},children:[(0,i.jsx)(b.A,{children:"プレイヤー名の編集"}),(0,i.jsxs)(w.A,{children:[c.length>0&&(0,i.jsxs)(E.A,{fullWidth:!0,margin:"dense",children:[(0,i.jsx)(I.A,{children:"登録済みプレイヤー名から選択"}),(0,i.jsx)(R.A,{value:"",onChange:e=>{j(e.target.value)},label:"登録済みプレイヤー名から選択",children:c.map(e=>(0,i.jsx)(k.A,{value:e.name,children:e.name},e.id))})]}),(0,i.jsx)(P.A,{value:f,onChange:e=>j(e.target.value),inputRef:g,fullWidth:!0,margin:"dense",label:"プレイヤー名",onKeyDown:e=>{"Enter"===e.key&&T()}})]}),(0,i.jsxs)(N.A,{children:[(0,i.jsx)(_.A,{onClick:L,children:"キャンセル"}),(0,i.jsx)(_.A,{onClick:T,variant:"contained",children:"保存"})]})]})]})};var T=t(7199);function q(){let{players:e,addPlayer:r,removeLastPlayer:t,resetAll:j}=(0,Y.Q)();return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(l.A,{position:"static",children:(0,i.jsxs)(n.A,{children:[(0,i.jsx)(s.A,{variant:"h6",component:"div",sx:{flexGrow:1},children:"スコアボード"}),(0,i.jsx)(a.A,{title:"プレイヤーを追加 (".concat(e.length,"/").concat(T.iq,")"),children:(0,i.jsx)("span",{children:(0,i.jsx)(o.A,{color:"inherit",onClick:r,disabled:e.length>=T.iq,sx:{mr:2},children:(0,i.jsx)(h.A,{})})})}),(0,i.jsx)(a.A,{title:"プレイヤーを削除",children:(0,i.jsx)("span",{children:(0,i.jsx)(o.A,{color:"inherit",onClick:t,disabled:e.length<=T.wC,sx:{mr:2},children:(0,i.jsx)(x.A,{})})})}),(0,i.jsx)(a.A,{title:"初期化",children:(0,i.jsx)(o.A,{color:"inherit",onClick:()=>{window.confirm("すべてのプレイヤーとスコア履歴を初期化しますか？")&&j()},sx:{mr:2},children:(0,i.jsx)(m.A,{})})}),(0,i.jsx)(a.A,{title:"プレイヤー名管理",children:(0,i.jsx)(o.A,{color:"inherit",component:g(),href:"/players",sx:{mr:2},children:(0,i.jsx)(f.A,{})})}),(0,i.jsx)(a.A,{title:"履歴",children:(0,i.jsx)(o.A,{color:"inherit",component:g(),href:"/history",children:(0,i.jsx)(p.A,{})})})]})}),(0,i.jsx)(c.A,{maxWidth:"lg",sx:{py:3},children:(0,i.jsx)(d.A,{container:!0,spacing:2,children:e.map(e=>(0,i.jsx)(d.A,{size:6,children:(0,i.jsx)(L,{player:e})},e.id))})})]})}}},e=>{e.O(0,[422,229,725,52,360,441,255,358],()=>e(e.s=48)),_N_E=e.O()}]);